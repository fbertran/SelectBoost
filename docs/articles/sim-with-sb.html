<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation Tools Provided With the Selectboost Package • SelectBoost</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Tools Provided With the Selectboost Package">
<meta property="og:description" content="SelectBoost">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SelectBoost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmarking-selectboost-networks.html">Benchmarking the SelectBoost Package for Network Reverse Engineering</a>
    </li>
    <li>
      <a href="../articles/confidence-indices-Cascade-networks.html">Towards Confidence Estimates in Cascade Networks using the SelectBoost Package</a>
    </li>
    <li>
      <a href="../articles/sim-with-sb.html">Simulation Tools Provided With the Selectboost Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fbertran/SelectBoost/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sim-with-sb_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation Tools Provided With the Selectboost Package</h1>
                        <h4 class="author">Frédéric Bertrand and Myriam Maumy-Bertrand</h4>
            <address class="author_afil">
      Université de Strasbourg and CNRSIRMA, labex IRMIA<br><a class="author_email" href="mailto:#"></a><a href="mailto:frederic.bertrand@math.unistra.fr" class="email">frederic.bertrand@math.unistra.fr</a>
      </address>
                  
            <h4 class="date">2021-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fbertran/SelectBoost/blob/master/vignettes/sim-with-sb.Rmd"><code>vignettes/sim-with-sb.Rmd</code></a></small>
      <div class="hidden name"><code>sim-with-sb.Rmd</code></div>

    </div>

    
    
<div id="contents" class="section level1">
<h1 class="hasAnchor">
<a href="#contents" class="anchor"></a>Contents</h1>
<p>This vignette details the simulations tools provided with the selectboost package by providing five examples of use.</p>
<p>If you are a Linux/Unix or a Macos user, you can install a version of SelectBoost with support for <code>doMC</code> from <a href="https://github.com">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"fbertran/SelectBoost"</span>, ref <span class="op">=</span> <span class="st">"doMC"</span><span class="op">)</span></code></pre></div>
</div>
<div id="first-example" class="section level1">
<h1 class="hasAnchor">
<a href="#first-example" class="anchor"></a>First example</h1>
<div id="aim" class="section level2">
<h2 class="hasAnchor">
<a href="#aim" class="anchor"></a>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=10\)</span> variables and <span class="math inline">\(N=10\)</span> observations. In that example we want <span class="math inline">\(9\)</span> groups:</p>
<ul>
<li>
<span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_{10}\)</span> belong to the first group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.95\)</span>,</li>
<li>
<span class="math inline">\(x_2\)</span> belongs to the second group,</li>
<li>
<span class="math inline">\(x_3\)</span> belongs to the third group,</li>
<li>…</li>
<li>
<span class="math inline">\(x_9\)</span> belongs to the ninth group.</li>
</ul>
</div>
<div id="correlation-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-structure" class="anchor"></a>Correlation structure</h2>
<p>The correlation structure of the explanatory variables of the dataset is provided by <code>group</code> and the intra-group Pearson correlation value for each of the groups by <code>cor_group</code>. A value must be provided even for single variable groups and the number of variables is length of the <code>group</code> vector. Use the <code>simulation_cor</code> function to create the correlation matrix (<code>CM</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fbertran/SelectBoost">SelectBoost</a></span><span class="op">)</span>
<span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#10 variables</span>
<span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">9</span><span class="op">)</span>
<span class="va">CM</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span>
<span class="va">CM</span>
<span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span>
<span class="co">#&gt;  [1,] 1.00    0    0    0    0    0    0    0    0  0.95</span>
<span class="co">#&gt;  [2,] 0.00    1    0    0    0    0    0    0    0  0.00</span>
<span class="co">#&gt;  [3,] 0.00    0    1    0    0    0    0    0    0  0.00</span>
<span class="co">#&gt;  [4,] 0.00    0    0    1    0    0    0    0    0  0.00</span>
<span class="co">#&gt;  [5,] 0.00    0    0    0    1    0    0    0    0  0.00</span>
<span class="co">#&gt;  [6,] 0.00    0    0    0    0    1    0    0    0  0.00</span>
<span class="co">#&gt;  [7,] 0.00    0    0    0    0    0    1    0    0  0.00</span>
<span class="co">#&gt;  [8,] 0.00    0    0    0    0    0    0    1    0  0.00</span>
<span class="co">#&gt;  [9,] 0.00    0    0    0    0    0    0    0    1  0.00</span>
<span class="co">#&gt; [10,] 0.95    0    0    0    0    0    0    0    0  1.00</span></code></pre></div>
</div>
<div id="explanatory-dataset-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#explanatory-dataset-generation" class="anchor"></a>Explanatory dataset generation</h2>
<p>Then generation of an explanatory dataset with <span class="math inline">\(N=10\)</span> observations is made by the <code>simulation_X</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">N</span><span class="op">&lt;-</span><span class="fl">10</span>
<span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span>
<span class="va">X</span>
<span class="co">#&gt;              [,1]       [,2]        [,3]       [,4]        [,5]        [,6]</span>
<span class="co">#&gt;  [1,]  0.69029599 -1.7343187  0.38993973  0.7530345  0.73462394  1.91645527</span>
<span class="co">#&gt;  [2,] -0.55429733  1.5236359 -0.44435298 -0.8293970  0.02137105  1.62014297</span>
<span class="co">#&gt;  [3,] -0.65277340 -0.2365804 -0.33365748  1.6144115 -1.38882044  1.18979400</span>
<span class="co">#&gt;  [4,]  0.06979050 -0.1798988 -0.01576611 -1.6377538 -0.85286458  0.07352177</span>
<span class="co">#&gt;  [5,] -0.58450206 -1.7411024 -0.13801223 -0.4512545 -0.14449068 -0.77910581</span>
<span class="co">#&gt;  [6,] -1.26045088  0.2087882 -0.72491869  0.6856348 -0.43163916 -1.62517684</span>
<span class="co">#&gt;  [7,]  0.03836372  0.4497529 -0.14266131 -0.6019886  1.36552523  0.14761767</span>
<span class="co">#&gt;  [8,] -0.52083678 -0.7626927  0.12068723 -1.6146444  0.79777307  2.41326136</span>
<span class="co">#&gt;  [9,]  0.30631735  0.9848562 -0.73193720 -1.2236526 -0.59785470 -0.13138414</span>
<span class="co">#&gt; [10,] -1.67366702  0.8709858 -0.80617294 -0.7559627  1.76655800  0.58235105</span>
<span class="co">#&gt;              [,7]       [,8]       [,9]       [,10]</span>
<span class="co">#&gt;  [1,]  0.23481727 -0.2019611 -1.0254989  0.97524648</span>
<span class="co">#&gt;  [2,] -0.11230652  1.7600720  1.4330532 -0.46696929</span>
<span class="co">#&gt;  [3,]  1.80315380 -0.7423216 -0.3679811 -0.83315697</span>
<span class="co">#&gt;  [4,] -0.30160066  0.6676371  2.0313025 -0.07749897</span>
<span class="co">#&gt;  [5,]  0.04835639  0.8040776 -0.2039855 -0.75413152</span>
<span class="co">#&gt;  [6,]  0.56503309 -0.1387350 -0.4091602 -1.09688456</span>
<span class="co">#&gt;  [7,]  1.17868940  0.5279960 -0.5626160 -0.09706896</span>
<span class="co">#&gt;  [8,] -1.64916614 -0.6481176  1.7608488 -0.69320924</span>
<span class="co">#&gt;  [9,] -0.44649730  0.4507879  1.4486604  0.60032266</span>
<span class="co">#&gt; [10,] -1.48612450  0.1245139 -0.9288625 -1.10028291</span></code></pre></div>
</div>
<div id="response-derivation" class="section level2">
<h2 class="hasAnchor">
<a href="#response-derivation" class="anchor"></a>Response derivation</h2>
<p>A response can now be added to the dataset by the <code>simulation_Data</code> function. We have to specifiy the support of the response, i.e. the explanatory variables that will be used in the linear model created to compute the response. The support is given by the <code>supp</code> vector whose entries are either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. The length of the <code>supp</code> vector must be equal to the number of explanatory variables and if the <span class="math inline">\(i\)</span>entry is equal to <span class="math inline">\(1\)</span>, it means that the <span class="math inline">\(i\)</span>variable will be used to derive the response value, whereas if the <span class="math inline">\(i\)</span>entry is equal to <span class="math inline">\(0\)</span>, it means that the <span class="math inline">\(i\)</span>variable will not be used to derive the response value (<code>beta&lt;-rep(0,length(supp))</code>). The values of the coefficients for the explanatory variables that are in the support of the response are random (either absolute value and sign) and given by <code>beta[which(supp==1)]&lt;-runif(sum(supp),minB,maxB)*(rbinom(sum(supp),1,.5)*2-1)</code>. Hence, the user can specify their minimal absolute value with the <code>minB</code> option and their maximal absolute value with the <code>maxB</code> option. The <code>stn</code> option is a scaling factor for the noise added to the response vector (<code>(t(beta)%*%var(X)%*%beta)/stn</code>, with <code>X</code> the matrix of explanatory variables). The higher the <code>stn</code> value, the smaller the noise: for instance for a given <code>X</code> dataset, an <code>stn</code> value <span class="math inline">\(\alpha\)</span> times larger will result in a noise exactly <span class="math inline">\(\sqrt{\alpha}\)</span> times smaller.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>
<span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span>
<span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span>
<span class="va">firstdataset</span><span class="op">=</span><span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span>
<span class="va">firstdataset</span>
<span class="co">#&gt; $X</span>
<span class="co">#&gt;              [,1]       [,2]        [,3]       [,4]        [,5]        [,6]</span>
<span class="co">#&gt;  [1,]  0.69029599 -1.7343187  0.38993973  0.7530345  0.73462394  1.91645527</span>
<span class="co">#&gt;  [2,] -0.55429733  1.5236359 -0.44435298 -0.8293970  0.02137105  1.62014297</span>
<span class="co">#&gt;  [3,] -0.65277340 -0.2365804 -0.33365748  1.6144115 -1.38882044  1.18979400</span>
<span class="co">#&gt;  [4,]  0.06979050 -0.1798988 -0.01576611 -1.6377538 -0.85286458  0.07352177</span>
<span class="co">#&gt;  [5,] -0.58450206 -1.7411024 -0.13801223 -0.4512545 -0.14449068 -0.77910581</span>
<span class="co">#&gt;  [6,] -1.26045088  0.2087882 -0.72491869  0.6856348 -0.43163916 -1.62517684</span>
<span class="co">#&gt;  [7,]  0.03836372  0.4497529 -0.14266131 -0.6019886  1.36552523  0.14761767</span>
<span class="co">#&gt;  [8,] -0.52083678 -0.7626927  0.12068723 -1.6146444  0.79777307  2.41326136</span>
<span class="co">#&gt;  [9,]  0.30631735  0.9848562 -0.73193720 -1.2236526 -0.59785470 -0.13138414</span>
<span class="co">#&gt; [10,] -1.67366702  0.8709858 -0.80617294 -0.7559627  1.76655800  0.58235105</span>
<span class="co">#&gt;              [,7]       [,8]       [,9]       [,10]</span>
<span class="co">#&gt;  [1,]  0.23481727 -0.2019611 -1.0254989  0.97524648</span>
<span class="co">#&gt;  [2,] -0.11230652  1.7600720  1.4330532 -0.46696929</span>
<span class="co">#&gt;  [3,]  1.80315380 -0.7423216 -0.3679811 -0.83315697</span>
<span class="co">#&gt;  [4,] -0.30160066  0.6676371  2.0313025 -0.07749897</span>
<span class="co">#&gt;  [5,]  0.04835639  0.8040776 -0.2039855 -0.75413152</span>
<span class="co">#&gt;  [6,]  0.56503309 -0.1387350 -0.4091602 -1.09688456</span>
<span class="co">#&gt;  [7,]  1.17868940  0.5279960 -0.5626160 -0.09706896</span>
<span class="co">#&gt;  [8,] -1.64916614 -0.6481176  1.7608488 -0.69320924</span>
<span class="co">#&gt;  [9,] -0.44649730  0.4507879  1.4486604  0.60032266</span>
<span class="co">#&gt; [10,] -1.48612450  0.1245139 -0.9288625 -1.10028291</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Y</span>
<span class="co">#&gt;  [1] -4.2132936  3.5039588  0.3332549 -0.4924011 -2.5391834  1.8674007</span>
<span class="co">#&gt;  [7]  0.6678607 -0.4589311  0.6353867  3.8091855</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $support</span>
<span class="co">#&gt;  [1] 1 1 1 0 0 0 0 0 0 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $beta</span>
<span class="co">#&gt;  [1] -1.754996  1.964992  1.041431  0.000000  0.000000  0.000000  0.000000</span>
<span class="co">#&gt;  [8]  0.000000  0.000000  0.000000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $stn</span>
<span class="co">#&gt; [1] 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sigma</span>
<span class="co">#&gt;           [,1]</span>
<span class="co">#&gt; [1,] 0.3493447</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "simuls"</span></code></pre></div>
</div>
<div id="multiple-datasets-and-checks" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-datasets-and-checks" class="anchor"></a>Multiple datasets and checks</h2>
<p>To generate multiple datasets, repeat steps 2 and 3, for instance use a <code>for</code> loop. We create <span class="math inline">\(NDatasets=200\)</span> datasets and assign them to the objects <code>DATA_exemple1_nb_1</code> to <code>DATA_exemple1_nb_200</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">NDatasets</span><span class="op">=</span><span class="fl">200</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_mean</span>
<span class="co">#&gt;                [,1]          [,2]          [,3]          [,4]         [,5]</span>
<span class="co">#&gt;  [1,]  1.0000000000 -0.0008611262  0.0193872629  0.0192496952 -0.012147407</span>
<span class="co">#&gt;  [2,] -0.0008611262  1.0000000000 -0.0520800766  0.0144798781  0.006237499</span>
<span class="co">#&gt;  [3,]  0.0193872629 -0.0520800766  1.0000000000  0.0008693002 -0.021373842</span>
<span class="co">#&gt;  [4,]  0.0192496952  0.0144798781  0.0008693002  1.0000000000  0.007753693</span>
<span class="co">#&gt;  [5,] -0.0121474071  0.0062374994 -0.0213738420  0.0077536931  1.000000000</span>
<span class="co">#&gt;  [6,] -0.0089756967 -0.0404111300  0.0344817040  0.0081889675  0.018018674</span>
<span class="co">#&gt;  [7,] -0.0082911544  0.0072612885 -0.0233188445 -0.0380192689  0.023833224</span>
<span class="co">#&gt;  [8,]  0.0272233550 -0.0066654749 -0.0487035643  0.0172624295  0.043181249</span>
<span class="co">#&gt;  [9,] -0.0145986545  0.0071146338  0.0364868095 -0.0020153080 -0.027733046</span>
<span class="co">#&gt; [10,]  0.9422544272 -0.0071281448  0.0264886880  0.0221950354 -0.003811061</span>
<span class="co">#&gt;               [,6]         [,7]         [,8]         [,9]        [,10]</span>
<span class="co">#&gt;  [1,] -0.008975697 -0.008291154  0.027223355 -0.014598655  0.942254427</span>
<span class="co">#&gt;  [2,] -0.040411130  0.007261289 -0.006665475  0.007114634 -0.007128145</span>
<span class="co">#&gt;  [3,]  0.034481704 -0.023318845 -0.048703564  0.036486809  0.026488688</span>
<span class="co">#&gt;  [4,]  0.008188968 -0.038019269  0.017262430 -0.002015308  0.022195035</span>
<span class="co">#&gt;  [5,]  0.018018674  0.023833224  0.043181249 -0.027733046 -0.003811061</span>
<span class="co">#&gt;  [6,]  1.000000000 -0.015449494 -0.004054573  0.006159349  0.003444504</span>
<span class="co">#&gt;  [7,] -0.015449494  1.000000000 -0.002105066  0.005052182 -0.018230902</span>
<span class="co">#&gt;  [8,] -0.004054573 -0.002105066  1.000000000 -0.003169857  0.021688766</span>
<span class="co">#&gt;  [9,]  0.006159349  0.005052182 -0.003169857  1.000000000 -0.013388952</span>
<span class="co">#&gt; [10,]  0.003444504 -0.018230902  0.021688766 -0.013388952  1.000000000</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean coefficient vector values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_mean</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 1.508327e+00 1.518967e+00 1.491694e+00 1.437883e-15 1.857978e-15 2.524863e-15 </span>
<span class="co">#&gt;           x7           x8           x9          x10 </span>
<span class="co">#&gt; 1.848380e-15 2.314167e-15 2.601342e-15 6.269818e-15</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Reduce the noise in the response for the new responses by a factor <span class="math inline">\(\sqrt{5000/50}=10\)</span>. <span class="math inline">\(1/stn\cdot \beta_{support}^t\mathrm{Var}(X)\beta_{support}\)</span> where <span class="math inline">\(\beta_{support}\)</span> is the vector of coefficients wh</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">stn</span> <span class="op">&lt;-</span> <span class="fl">5000</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Since it is the same explanatory dataset for response generation, we can compare the <span class="math inline">\(\sigma\)</span> between those <span class="math inline">\(NDatasets=200\)</span> datasets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stn_ratios</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NDatasets</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">stn_ratios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">/</span>
  <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">stn_ratios</span>,<span class="va">all.equal</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>All the ratios are equal to 10 as anticipated.</p>
<p>Since, the correlation structure is the same as before, we do not need to check it again. As befor, we infer the coefficients values of a linear model using the <code>lm</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum_bis</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum_bis</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter_bis</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter_bis</span><span class="op">=</span><span class="va">error_counte_bisr</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum_bis</span><span class="op">=</span><span class="va">coef_sum_bis</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter_bis</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean_bis</span><span class="op">=</span><span class="va">coef_sum_bis</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean coefficient vector values. As expected, the noise reduction enhances the retrieval of the <code>true</code> mean coefficient absolute values by the models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_mean_bis</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 1.508327e+00 1.518967e+00 1.491694e+00 1.437883e-15 1.857978e-15 2.524863e-15 </span>
<span class="co">#&gt;           x7           x8           x9          x10 </span>
<span class="co">#&gt; 1.848380e-15 2.314167e-15 2.601342e-15 6.269818e-15</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean_bis</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The simulation process looks sucessfull. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="second-example" class="section level1">
<h1 class="hasAnchor">
<a href="#second-example" class="anchor"></a>Second example</h1>
<div id="aim-1" class="section level2">
<h2 class="hasAnchor">
<a href="#aim-1" class="anchor"></a>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=50\)</span> variables and <span class="math inline">\(N=20\)</span> observations. In that example we want <span class="math inline">\(1\)</span> group:</p>
<ul>
<li>
<span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{50}\)</span> belong to the same group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.5\)</span>.</li>
<li>only the first five variables <span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{5}\)</span> are explanatory variables for the response.</li>
</ul>
</div>
<div id="correlation-structure-1" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-structure-1" class="anchor"></a>Correlation structure</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">50</span><span class="op">)</span> <span class="co">#50 variables</span>
<span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="explanatory-variables-and-response" class="section level2">
<h2 class="hasAnchor">
<a href="#explanatory-variables-and-response" class="anchor"></a>Explanatory variables and response</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">N</span><span class="op">&lt;-</span><span class="fl">20</span>
<span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span>
<span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span>
<span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span><span class="op">{</span>
<span class="va">C</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span>
<span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">C</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="checks" class="section level2">
<h2 class="hasAnchor">
<a href="#checks" class="anchor"></a>Checks</h2>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span>
<span class="co">#&gt;  [1,] 1.0000000 0.4875195 0.4774265 0.4739869 0.4796578 0.4927521 0.4898313</span>
<span class="co">#&gt;  [2,] 0.4875195 1.0000000 0.4750680 0.4940743 0.4842295 0.4988293 0.4937678</span>
<span class="co">#&gt;  [3,] 0.4774265 0.4750680 1.0000000 0.4799584 0.4690139 0.4831884 0.4765315</span>
<span class="co">#&gt;  [4,] 0.4739869 0.4940743 0.4799584 1.0000000 0.4990798 0.4995625 0.4928739</span>
<span class="co">#&gt;  [5,] 0.4796578 0.4842295 0.4690139 0.4990798 1.0000000 0.4890548 0.4839137</span>
<span class="co">#&gt;  [6,] 0.4927521 0.4988293 0.4831884 0.4995625 0.4890548 1.0000000 0.4980120</span>
<span class="co">#&gt;  [7,] 0.4898313 0.4937678 0.4765315 0.4928739 0.4839137 0.4980120 1.0000000</span>
<span class="co">#&gt;  [8,] 0.4786241 0.4904904 0.4871110 0.4799335 0.4807772 0.5015775 0.4766888</span>
<span class="co">#&gt;  [9,] 0.4821186 0.4801270 0.4648431 0.4774361 0.4657147 0.4942747 0.4786140</span>
<span class="co">#&gt; [10,] 0.4875410 0.4690954 0.4669033 0.4832185 0.4781301 0.4873754 0.4825714</span>
<span class="co">#&gt;            [,8]      [,9]     [,10]</span>
<span class="co">#&gt;  [1,] 0.4786241 0.4821186 0.4875410</span>
<span class="co">#&gt;  [2,] 0.4904904 0.4801270 0.4690954</span>
<span class="co">#&gt;  [3,] 0.4871110 0.4648431 0.4669033</span>
<span class="co">#&gt;  [4,] 0.4799335 0.4774361 0.4832185</span>
<span class="co">#&gt;  [5,] 0.4807772 0.4657147 0.4781301</span>
<span class="co">#&gt;  [6,] 0.5015775 0.4942747 0.4873754</span>
<span class="co">#&gt;  [7,] 0.4766888 0.4786140 0.4825714</span>
<span class="co">#&gt;  [8,] 1.0000000 0.4783224 0.4832658</span>
<span class="co">#&gt;  [9,] 0.4783224 1.0000000 0.4769654</span>
<span class="co">#&gt; [10,] 0.4832658 0.4769654 1.0000000</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-stat.stanford.edu/~hastie/Papers/#LARS">lars</a></span><span class="op">)</span>
<span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, 
              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span>
<span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, 
              plot.it<span class="op">=</span><span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span>
<span class="co"># Use the "+1SE rule" to find best model: </span>
<span class="co">#    Take the min CV and add its SE ("limit").  </span>
<span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span>
<span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span>
<span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Print out coefficients at optimal s.</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span>
<span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_mean</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 1.500084e+00 1.492942e+00 1.496050e+00 1.528043e+00 1.497537e+00 2.577168e-15 </span>
<span class="co">#&gt;           x7           x8           x9          x10          x11          x12 </span>
<span class="co">#&gt; 6.820231e-15 3.386509e-15 4.297997e-15 7.216331e-15 3.528058e-15 1.001056e-14 </span>
<span class="co">#&gt;          x13          x14          x15          x16          x17          x18 </span>
<span class="co">#&gt; 6.068207e-15 9.640427e-15 5.351262e-15 9.276245e-15 5.295417e-15 8.227904e-15 </span>
<span class="co">#&gt;          x19          x20          x21          x22          x23          x24 </span>
<span class="co">#&gt; 5.860229e-15 4.724224e-15           NA           NA           NA           NA </span>
<span class="co">#&gt;          x25          x26          x27          x28          x29          x30 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x31          x32          x33          x34          x35          x36 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x37          x38          x39          x40          x41          x42 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x43          x44          x45          x46          x47          x48 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x49          x50 </span>
<span class="co">#&gt;           NA           NA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_lasso_mean</span>
<span class="co">#&gt;          x1          x2          x3          x4          x5          x6 </span>
<span class="co">#&gt; 1.040812405 1.024444248 1.065905971 1.058866701 0.996624348 0.007811962 </span>
<span class="co">#&gt;          x7          x8          x9         x10         x11         x12 </span>
<span class="co">#&gt; 0.015952857 0.010284528 0.025145014 0.019259508 0.014825470 0.023340488 </span>
<span class="co">#&gt;         x13         x14         x15         x16         x17         x18 </span>
<span class="co">#&gt; 0.015909217 0.013040568 0.012039290 0.007597800 0.009091856 0.016135853 </span>
<span class="co">#&gt;         x19         x20         x21         x22         x23         x24 </span>
<span class="co">#&gt; 0.006510554 0.017700262 0.024024125 0.026401587 0.016510921 0.006350005 </span>
<span class="co">#&gt;         x25         x26         x27         x28         x29         x30 </span>
<span class="co">#&gt; 0.015389373 0.013108940 0.022619351 0.008526745 0.003851395 0.026688493 </span>
<span class="co">#&gt;         x31         x32         x33         x34         x35         x36 </span>
<span class="co">#&gt; 0.013608283 0.010260901 0.019494725 0.008485431 0.008627058 0.019809449 </span>
<span class="co">#&gt;         x37         x38         x39         x40         x41         x42 </span>
<span class="co">#&gt; 0.015047270 0.007562486 0.005826465 0.008270178 0.009596887 0.016556957 </span>
<span class="co">#&gt;         x43         x44         x45         x46         x47         x48 </span>
<span class="co">#&gt; 0.014522021 0.016432803 0.003504785 0.008892051 0.012878671 0.011623352 </span>
<span class="co">#&gt;         x49         x50 </span>
<span class="co">#&gt; 0.004653053 0.010384327</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="third-example" class="section level1">
<h1 class="hasAnchor">
<a href="#third-example" class="anchor"></a>Third Example</h1>
<div id="aim-2" class="section level2">
<h2 class="hasAnchor">
<a href="#aim-2" class="anchor"></a>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(supp)=100\)</span> variables and <span class="math inline">\(N=24\)</span> observations. In that example we use real data for the <code>X</code> variables that we sample from all the <span class="math inline">\(1650\)</span> probesets that are differentially expressed between the two conditions US and S. The main interest of that simulation is that the correlation structure of the <code>X</code> dataset will be a real one.</p>
</div>
<div id="data-and-response-generations" class="section level2">
<h2 class="hasAnchor">
<a href="#data-and-response-generations" class="anchor"></a>Data and response generations</h2>
<p>First retrieve the datasets and get the differentially expressed probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-irma.u-strasbg.fr/~fbertran/">CascadeData</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">micro_S</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">micro_US</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-irma.u-strasbg.fr/~fbertran/">Cascade</a></span><span class="op">)</span>
<span class="va">micro_US</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/as.micro_array.html">as.micro_array</a></span><span class="op">(</span><span class="va">micro_US</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span>
<span class="va">micro_S</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/as.micro_array.html">as.micro_array</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span>
<span class="va">S</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/geneSelection.html">geneSelection</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="va">micro_US</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"condition"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="va">Sel</span><span class="op">&lt;-</span><span class="va">micro_S</span><span class="op">@</span><span class="va">microarray</span><span class="op">[</span><span class="va">S</span><span class="op">@</span><span class="va">name</span>,<span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>
<span class="co">#&gt;    N1_US_T60           N1_US_T90          N1_US_T210         N1_US_T390      </span>
<span class="co">#&gt;  Min.   :-3.445442   Min.   :-4.28468   Min.   :-5.08296   Min.   :-4.68431  </span>
<span class="co">#&gt;  1st Qu.:-0.142287   1st Qu.:-0.07960   1st Qu.:-0.78755   1st Qu.:-0.62401  </span>
<span class="co">#&gt;  Median :-0.033095   Median : 0.10331   Median : 0.39450   Median : 0.32171  </span>
<span class="co">#&gt;  Mean   :-0.002321   Mean   : 0.07994   Mean   : 0.04299   Mean   : 0.08204  </span>
<span class="co">#&gt;  3rd Qu.: 0.110515   3rd Qu.: 0.28131   3rd Qu.: 0.78988   3rd Qu.: 0.66365  </span>
<span class="co">#&gt;  Max.   : 3.471966   Max.   : 2.93563   Max.   : 3.93893   Max.   : 3.18762  </span>
<span class="co">#&gt;    N2_US_T60         N2_US_T90          N2_US_T210         N2_US_T390      </span>
<span class="co">#&gt;  Min.   :-2.6027   Min.   :-3.37588   Min.   :-3.87950   Min.   :-4.61130  </span>
<span class="co">#&gt;  1st Qu.: 0.1760   1st Qu.:-0.22368   1st Qu.:-0.51207   1st Qu.:-0.36024  </span>
<span class="co">#&gt;  Median : 0.3461   Median :-0.09522   Median : 0.25689   Median : 0.22635  </span>
<span class="co">#&gt;  Mean   : 0.3528   Mean   :-0.11100   Mean   : 0.03797   Mean   : 0.03828  </span>
<span class="co">#&gt;  3rd Qu.: 0.5404   3rd Qu.: 0.02934   3rd Qu.: 0.57309   3rd Qu.: 0.43864  </span>
<span class="co">#&gt;  Max.   : 3.1862   Max.   : 3.10336   Max.   : 3.63905   Max.   : 2.76737  </span>
<span class="co">#&gt;    N3_US_T60           N3_US_T90          N3_US_T210         N3_US_T390     </span>
<span class="co">#&gt;  Min.   :-3.550140   Min.   :-4.36036   Min.   :-5.67972   Min.   :-4.5060  </span>
<span class="co">#&gt;  1st Qu.:-0.146245   1st Qu.:-0.12487   1st Qu.:-1.15095   1st Qu.:-0.4787  </span>
<span class="co">#&gt;  Median : 0.017224   Median : 0.11684   Median : 0.27993   Median : 0.4759  </span>
<span class="co">#&gt;  Mean   :-0.002654   Mean   : 0.01882   Mean   :-0.06901   Mean   : 0.2070  </span>
<span class="co">#&gt;  3rd Qu.: 0.185573   3rd Qu.: 0.29070   3rd Qu.: 0.80863   3rd Qu.: 0.7967  </span>
<span class="co">#&gt;  Max.   : 2.692240   Max.   : 3.98065   Max.   : 3.56704   Max.   : 3.7395  </span>
<span class="co">#&gt;    N4_US_T60          N4_US_T90          N4_US_T210         N4_US_T390      </span>
<span class="co">#&gt;  Min.   :-2.25607   Min.   :-3.60640   Min.   :-3.99245   Min.   :-3.25596  </span>
<span class="co">#&gt;  1st Qu.:-0.10098   1st Qu.:-0.03933   1st Qu.:-0.44414   1st Qu.:-0.28561  </span>
<span class="co">#&gt;  Median :-0.02510   Median : 0.10412   Median : 0.05968   Median : 0.01639  </span>
<span class="co">#&gt;  Mean   :-0.04386   Mean   : 0.03840   Mean   :-0.12505   Mean   :-0.07290  </span>
<span class="co">#&gt;  3rd Qu.: 0.04279   3rd Qu.: 0.21634   3rd Qu.: 0.24426   3rd Qu.: 0.17245  </span>
<span class="co">#&gt;  Max.   : 2.78691   Max.   : 3.39207   Max.   : 2.73437   Max.   : 3.56718  </span>
<span class="co">#&gt;    N5_US_T60           N5_US_T90          N5_US_T210         N5_US_T390      </span>
<span class="co">#&gt;  Min.   :-2.734367   Min.   :-3.32569   Min.   :-3.63519   Min.   :-3.42995  </span>
<span class="co">#&gt;  1st Qu.: 0.007341   1st Qu.:-0.13749   1st Qu.:-0.53121   1st Qu.:-0.23822  </span>
<span class="co">#&gt;  Median : 0.120659   Median : 0.02666   Median : 0.18888   Median : 0.24203  </span>
<span class="co">#&gt;  Mean   : 0.082653   Mean   :-0.03708   Mean   :-0.06209   Mean   : 0.09684  </span>
<span class="co">#&gt;  3rd Qu.: 0.210589   3rd Qu.: 0.14035   3rd Qu.: 0.41754   3rd Qu.: 0.43804  </span>
<span class="co">#&gt;  Max.   : 2.890372   Max.   : 3.21219   Max.   : 3.70482   Max.   : 3.10234  </span>
<span class="co">#&gt;    N6_US_T60           N6_US_T90           N6_US_T210         N6_US_T390      </span>
<span class="co">#&gt;  Min.   :-3.160354   Min.   :-3.261297   Min.   :-3.47610   Min.   :-4.15575  </span>
<span class="co">#&gt;  1st Qu.:-0.093522   1st Qu.:-0.151623   1st Qu.:-0.62330   1st Qu.:-0.44959  </span>
<span class="co">#&gt;  Median :-0.006127   Median : 0.068895   Median : 0.37171   Median : 0.23296  </span>
<span class="co">#&gt;  Mean   :-0.031932   Mean   : 0.005802   Mean   : 0.06757   Mean   : 0.05379  </span>
<span class="co">#&gt;  3rd Qu.: 0.075654   3rd Qu.: 0.238649   3rd Qu.: 0.66546   3rd Qu.: 0.49867  </span>
<span class="co">#&gt;  Max.   : 3.011000   Max.   : 2.803360   Max.   : 4.00612   Max.   : 3.31323</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Generates the datasets sampling for each of them 100 probesets expressions among the 1650 that were selected and linking the response to the expressions of the first five probesets.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span>
<span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span>
<span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span>
<span class="va">NDatasets</span><span class="op">=</span><span class="fl">200</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">Xnorm</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">Xnorm</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="checks-1" class="section level2">
<h2 class="hasAnchor">
<a href="#checks-1" class="anchor"></a>Checks</h2>
<p>Here are the plots of an example of correlation structure, namely for <code>DATA_exemple3_nb_200$X</code>. Run the code to get the graphics.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span>
<span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/cim.html">cim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">)</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-stat.stanford.edu/~hastie/Papers/#LARS">lars</a></span><span class="op">)</span>
<span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, 
              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span>
<span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, 
              plot.it<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span>
<span class="co"># Use the "+1SE rule" to find best model: </span>
<span class="co">#    Take the min CV and add its SE ("limit").  </span>
<span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span>
<span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span>
<span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Print out coefficients at optimal s.</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span>
<span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_mean</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 1.457741e+00 1.488627e+00 1.503719e+00 1.506939e+00 1.481887e+00 1.463622e-14 </span>
<span class="co">#&gt;           x7           x8           x9          x10          x11          x12 </span>
<span class="co">#&gt; 1.250379e-14 1.241973e-14 1.154723e-14 9.181216e-15 1.426020e-14 1.400520e-14 </span>
<span class="co">#&gt;          x13          x14          x15          x16          x17          x18 </span>
<span class="co">#&gt; 1.376739e-14 1.075624e-14 1.417228e-14 1.173325e-14 1.083780e-14 1.541663e-14 </span>
<span class="co">#&gt;          x19          x20          x21          x22          x23          x24 </span>
<span class="co">#&gt; 1.311993e-14 1.272276e-14 1.255378e-14 9.132597e-15 1.242458e-14 1.161036e-14 </span>
<span class="co">#&gt;          x25          x26          x27          x28          x29          x30 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x31          x32          x33          x34          x35          x36 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x37          x38          x39          x40          x41          x42 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x43          x44          x45          x46          x47          x48 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x49          x50          x51          x52          x53          x54 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x55          x56          x57          x58          x59          x60 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x61          x62          x63          x64          x65          x66 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x67          x68          x69          x70          x71          x72 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x73          x74          x75          x76          x77          x78 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x79          x80          x81          x82          x83          x84 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x85          x86          x87          x88          x89          x90 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x91          x92          x93          x94          x95          x96 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x97          x98          x99         x100 </span>
<span class="co">#&gt;           NA           NA           NA           NA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_lasso_mean</span>
<span class="co">#&gt;          x1          x2          x3          x4          x5          x6 </span>
<span class="co">#&gt; 0.698583469 0.720189491 0.810630146 0.746442403 0.754771512 0.024361345 </span>
<span class="co">#&gt;          x7          x8          x9         x10         x11         x12 </span>
<span class="co">#&gt; 0.015683388 0.010592875 0.011885616 0.014096938 0.020929967 0.011745083 </span>
<span class="co">#&gt;         x13         x14         x15         x16         x17         x18 </span>
<span class="co">#&gt; 0.013956787 0.022074586 0.014456640 0.015433682 0.023909028 0.016518641 </span>
<span class="co">#&gt;         x19         x20         x21         x22         x23         x24 </span>
<span class="co">#&gt; 0.021327747 0.013615245 0.019931987 0.018892285 0.014078848 0.023451766 </span>
<span class="co">#&gt;         x25         x26         x27         x28         x29         x30 </span>
<span class="co">#&gt; 0.021579606 0.018488386 0.012237622 0.013068995 0.016606079 0.032710099 </span>
<span class="co">#&gt;         x31         x32         x33         x34         x35         x36 </span>
<span class="co">#&gt; 0.017221981 0.025553452 0.011455537 0.007588747 0.012503354 0.027990603 </span>
<span class="co">#&gt;         x37         x38         x39         x40         x41         x42 </span>
<span class="co">#&gt; 0.012712409 0.017015175 0.015938244 0.020113071 0.015363207 0.021779451 </span>
<span class="co">#&gt;         x43         x44         x45         x46         x47         x48 </span>
<span class="co">#&gt; 0.015301467 0.023310117 0.009375730 0.028538708 0.010643011 0.012912658 </span>
<span class="co">#&gt;         x49         x50         x51         x52         x53         x54 </span>
<span class="co">#&gt; 0.021113253 0.022101301 0.019696163 0.017486521 0.012797403 0.017481204 </span>
<span class="co">#&gt;         x55         x56         x57         x58         x59         x60 </span>
<span class="co">#&gt; 0.021883771 0.020960943 0.017542692 0.007463007 0.014400504 0.020531679 </span>
<span class="co">#&gt;         x61         x62         x63         x64         x65         x66 </span>
<span class="co">#&gt; 0.020290916 0.017386233 0.015440217 0.019908764 0.011650804 0.012215833 </span>
<span class="co">#&gt;         x67         x68         x69         x70         x71         x72 </span>
<span class="co">#&gt; 0.017173039 0.019222570 0.022233419 0.012291879 0.023242248 0.021103892 </span>
<span class="co">#&gt;         x73         x74         x75         x76         x77         x78 </span>
<span class="co">#&gt; 0.019976721 0.012413973 0.009042247 0.024407614 0.011496152 0.022203795 </span>
<span class="co">#&gt;         x79         x80         x81         x82         x83         x84 </span>
<span class="co">#&gt; 0.024014558 0.012821418 0.014332526 0.014655681 0.020962653 0.010708244 </span>
<span class="co">#&gt;         x85         x86         x87         x88         x89         x90 </span>
<span class="co">#&gt; 0.016612993 0.013674264 0.025079440 0.018041856 0.016141391 0.023882556 </span>
<span class="co">#&gt;         x91         x92         x93         x94         x95         x96 </span>
<span class="co">#&gt; 0.023810103 0.011696891 0.010349792 0.011900366 0.019443916 0.019066927 </span>
<span class="co">#&gt;         x97         x98         x99        x100 </span>
<span class="co">#&gt; 0.016225119 0.016061081 0.012684836 0.018997083</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div id="fourth-example" class="section level1">
<h1 class="hasAnchor">
<a href="#fourth-example" class="anchor"></a>Fourth Example</h1>
<div id="aim-3" class="section level2">
<h2 class="hasAnchor">
<a href="#aim-3" class="anchor"></a>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=101\)</span> datasets with <span class="math inline">\(\textrm{length}(supp)=100\)</span> variables and <span class="math inline">\(N=18\)</span> observations. In that example we use real data for the variables that are the <span class="math inline">\(101\)</span> probesets that are the more differentially expressed between the two conditions US and S. We create <span class="math inline">\(101\)</span> datasets by leaving one of the variables out each time and using it as the response that shall be predicted. We also only use for the explanatory variables the observations that are the measurements for the 1st, 2nd and 3rd timepoints and for the responses the observations that are the measurements of the same variables for the 2nd, 3rd and 4th timepoints. The main interest of that simulation is that the correlation structure of the <code>X</code> dataset will be a real one and that it is a typical setting for cascade network reverse-engineering in genomics or proteomics, see the <code>Cascade</code> package for more details.</p>
</div>
<div id="data-and-response-generations-1" class="section level2">
<h2 class="hasAnchor">
<a href="#data-and-response-generations-1" class="anchor"></a>Data and response generations</h2>
<p>First retrieve the datasets and get the differentially expressed probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-irma.u-strasbg.fr/~fbertran/">CascadeData</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">micro_S</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">micro_US</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-irma.u-strasbg.fr/~fbertran/">Cascade</a></span><span class="op">)</span>
<span class="va">micro_US</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/as.micro_array.html">as.micro_array</a></span><span class="op">(</span><span class="va">micro_US</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span>
<span class="va">micro_S</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/as.micro_array.html">as.micro_array</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span>
<span class="va">S</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Cascade/man/geneSelection.html">geneSelection</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="va">micro_US</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"condition"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">101</span><span class="op">)</span>
<span class="va">Sel</span><span class="op">&lt;-</span><span class="va">micro_S</span><span class="op">@</span><span class="va">microarray</span><span class="op">[</span><span class="va">S</span><span class="op">@</span><span class="va">name</span>,<span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span>
<span class="co">#&gt;    N1_US_T60          N1_US_T90         N1_US_T210        N1_US_T390     </span>
<span class="co">#&gt;  Min.   :-2.86440   Min.   :-4.2847   Min.   :-4.5591   Min.   :-3.5620  </span>
<span class="co">#&gt;  1st Qu.:-0.27855   1st Qu.:-0.5322   1st Qu.:-1.5662   1st Qu.:-1.0324  </span>
<span class="co">#&gt;  Median :-0.11420   Median : 0.0229   Median :-0.8926   Median :-0.3158  </span>
<span class="co">#&gt;  Mean   :-0.25760   Mean   :-0.2284   Mean   :-0.4651   Mean   :-0.2925  </span>
<span class="co">#&gt;  3rd Qu.: 0.03457   3rd Qu.: 0.3970   3rd Qu.: 1.0840   3rd Qu.: 0.6128  </span>
<span class="co">#&gt;  Max.   : 0.59866   Max.   : 1.5979   Max.   : 1.8577   Max.   : 2.6810  </span>
<span class="co">#&gt;    N2_US_T60         N2_US_T90          N2_US_T210        N2_US_T390     </span>
<span class="co">#&gt;  Min.   :-2.0267   Min.   :-3.37588   Min.   :-2.9783   Min.   :-2.3026  </span>
<span class="co">#&gt;  1st Qu.: 0.1515   1st Qu.:-0.44572   1st Qu.:-1.2720   1st Qu.:-0.6091  </span>
<span class="co">#&gt;  Median : 0.3207   Median :-0.19104   Median :-0.6199   Median :-0.1629  </span>
<span class="co">#&gt;  Mean   : 0.2513   Mean   :-0.34924   Mean   :-0.4245   Mean   :-0.1582  </span>
<span class="co">#&gt;  3rd Qu.: 0.5239   3rd Qu.: 0.01764   3rd Qu.: 0.6264   3rd Qu.: 0.4601  </span>
<span class="co">#&gt;  Max.   : 1.4069   Max.   : 3.04749   Max.   : 1.7326   Max.   : 0.8499  </span>
<span class="co">#&gt;    N3_US_T60          N3_US_T90         N3_US_T210        N3_US_T390     </span>
<span class="co">#&gt;  Min.   :-3.31723   Min.   :-4.3604   Min.   :-5.3671   Min.   :-4.2055  </span>
<span class="co">#&gt;  1st Qu.:-0.49979   1st Qu.:-1.2628   1st Qu.:-1.9470   1st Qu.:-1.0143  </span>
<span class="co">#&gt;  Median :-0.06299   Median :-0.4540   Median :-1.0742   Median :-0.3669  </span>
<span class="co">#&gt;  Mean   :-0.29855   Mean   :-0.5145   Mean   :-0.6951   Mean   :-0.2288  </span>
<span class="co">#&gt;  3rd Qu.: 0.22531   3rd Qu.: 0.5196   3rd Qu.: 1.0217   3rd Qu.: 0.8482  </span>
<span class="co">#&gt;  Max.   : 0.94585   Max.   : 1.7065   Max.   : 2.2100   Max.   : 1.3611  </span>
<span class="co">#&gt;    N4_US_T60          N4_US_T90         N4_US_T210        N4_US_T390     </span>
<span class="co">#&gt;  Min.   :-1.82903   Min.   :-3.6064   Min.   :-3.1968   Min.   :-3.2560  </span>
<span class="co">#&gt;  1st Qu.:-0.20932   1st Qu.:-0.6953   1st Qu.:-1.0210   1st Qu.:-0.6339  </span>
<span class="co">#&gt;  Median :-0.05962   Median :-0.1442   Median :-0.4632   Median :-0.2058  </span>
<span class="co">#&gt;  Mean   :-0.15230   Mean   :-0.2774   Mean   :-0.5000   Mean   :-0.3218  </span>
<span class="co">#&gt;  3rd Qu.: 0.03940   3rd Qu.: 0.4080   3rd Qu.: 0.2534   3rd Qu.: 0.1055  </span>
<span class="co">#&gt;  Max.   : 1.90954   Max.   : 1.8458   Max.   : 1.8281   Max.   : 1.0341  </span>
<span class="co">#&gt;    N5_US_T60          N5_US_T90         N5_US_T210        N5_US_T390     </span>
<span class="co">#&gt;  Min.   :-2.54975   Min.   :-3.3257   Min.   :-3.4105   Min.   :-1.9624  </span>
<span class="co">#&gt;  1st Qu.:-0.20984   1st Qu.:-0.7611   1st Qu.:-1.3906   1st Qu.:-0.6373  </span>
<span class="co">#&gt;  Median : 0.08285   Median :-0.2723   Median :-0.6157   Median :-0.1902  </span>
<span class="co">#&gt;  Mean   :-0.10242   Mean   :-0.3500   Mean   :-0.5298   Mean   :-0.1621  </span>
<span class="co">#&gt;  3rd Qu.: 0.23124   3rd Qu.: 0.3838   3rd Qu.: 0.5024   3rd Qu.: 0.4586  </span>
<span class="co">#&gt;  Max.   : 1.33829   Max.   : 0.8780   Max.   : 1.2040   Max.   : 1.2305  </span>
<span class="co">#&gt;    N6_US_T60          N6_US_T90         N6_US_T210        N6_US_T390     </span>
<span class="co">#&gt;  Min.   :-3.16035   Min.   :-3.2613   Min.   :-3.4761   Min.   :-3.1015  </span>
<span class="co">#&gt;  1st Qu.:-0.41977   1st Qu.:-1.1226   1st Qu.:-1.3108   1st Qu.:-0.7930  </span>
<span class="co">#&gt;  Median :-0.09151   Median :-0.3160   Median :-0.7274   Median :-0.2896  </span>
<span class="co">#&gt;  Mean   :-0.30570   Mean   :-0.4130   Mean   :-0.4159   Mean   :-0.2531  </span>
<span class="co">#&gt;  3rd Qu.: 0.08889   3rd Qu.: 0.4766   3rd Qu.: 0.8294   3rd Qu.: 0.4834  </span>
<span class="co">#&gt;  Max.   : 0.61310   Max.   : 1.7452   Max.   : 1.4716   Max.   : 1.1834</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suppt</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span>
<span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span> <span class="co">#not used since we use one of the probeset expressions as response</span>
<span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span> <span class="co">#not used since we use one of the probeset expressions as response</span>
<span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span> <span class="co">#not used since we use one of the probeset expressions as response</span>
<span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span> <span class="co">#not used since we use one of the probeset expressions as response</span>
<span class="va">NDatasets</span><span class="op">&lt;-</span><span class="fl">101</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#the explanatory variables are the values for the 1st, 2nd and 3rd timepoints</span>
  <span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="op">-</span><span class="va">i</span>,<span class="va">suppt</span><span class="op">!=</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Xnorm</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">DATA</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">Xnorm</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span>
  <span class="co">#the reponses are the values for the 2nd, 3rd and 4th timepoints</span>
  <span class="va">DATA</span><span class="op">$</span><span class="va">Y</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="va">i</span>,<span class="va">suppt</span><span class="op">!=</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="va">DATA</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="checks-2" class="section level2">
<h2 class="hasAnchor">
<a href="#checks-2" class="anchor"></a>Checks</h2>
<p>Here are the plots of an example of correlation structure, namely for <code>DATA_exemple3_nb_200$X</code>. Run the code to get the graphics.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span>
<span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/cim.html">cim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-stat.stanford.edu/~hastie/Papers/#LARS">lars</a></span><span class="op">)</span>
<span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, 
              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span>
<span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, 
              plot.it<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span>
<span class="co"># Use the "+1SE rule" to find best model: </span>
<span class="co">#    Take the min CV and add its SE ("limit").  </span>
<span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span>
<span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span>
<span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Print out coefficients at optimal s.</span>
<span class="va">coef_lasso_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span>
<span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">coef_mean</span>, <span class="fl">40</span><span class="op">)</span>
<span class="co">#&gt;       x1       x2       x3       x4       x5       x6       x7       x8 </span>
<span class="co">#&gt; 2248.272 2853.555 1621.780 3766.243 3261.185 2951.494 2532.662 1849.877 </span>
<span class="co">#&gt;       x9      x10      x11      x12      x13      x14      x15      x16 </span>
<span class="co">#&gt; 7123.990 4535.791 4758.085 2069.225 1517.617 5293.455 1503.779 1328.183 </span>
<span class="co">#&gt;      x17      x18      x19      x20      x21      x22      x23      x24 </span>
<span class="co">#&gt; 7760.637 2140.740       NA       NA       NA       NA       NA       NA </span>
<span class="co">#&gt;      x25      x26      x27      x28      x29      x30      x31      x32 </span>
<span class="co">#&gt;       NA       NA       NA       NA       NA       NA       NA       NA </span>
<span class="co">#&gt;      x33      x34      x35      x36      x37      x38      x39      x40 </span>
<span class="co">#&gt;       NA       NA       NA       NA       NA       NA       NA       NA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>, <span class="fl">40</span><span class="op">)</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt;  15.54572730  14.58227728   4.95845727   0.46353875   1.00330697  29.55699720 </span>
<span class="co">#&gt;           x7           x8           x9          x10          x11          x12 </span>
<span class="co">#&gt;  21.34444981   0.83829989  18.81081187  17.57661299   2.75710443  13.09893938 </span>
<span class="co">#&gt;          x13          x14          x15          x16          x17          x18 </span>
<span class="co">#&gt;  31.33928841  16.54387748   5.30914304   0.00000000   1.99138104   0.00000000 </span>
<span class="co">#&gt;          x19          x20          x21          x22          x23          x24 </span>
<span class="co">#&gt;   4.35699583   0.75449031  44.78090867  18.67703579   0.92835303   2.91925792 </span>
<span class="co">#&gt;          x25          x26          x27          x28          x29          x30 </span>
<span class="co">#&gt;  17.77204643   0.00000000   0.00000000   0.06240116  13.18244817  23.56341540 </span>
<span class="co">#&gt;          x31          x32          x33          x34          x35          x36 </span>
<span class="co">#&gt;  16.98378204 102.13843333  59.14623441  36.64445640   0.00000000  59.82919657 </span>
<span class="co">#&gt;          x37          x38          x39          x40 </span>
<span class="co">#&gt;  44.57764098   0.00000000   0.00000000   0.00000000</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>Some probesets seem explanatory for many other ones (=hubs). What are the confidence indices for those variables?</p>
</div>
</div>
<div id="fifth-example" class="section level1">
<h1 class="hasAnchor">
<a href="#fifth-example" class="anchor"></a>Fifth Example</h1>
<div id="aim-4" class="section level2">
<h2 class="hasAnchor">
<a href="#aim-4" class="anchor"></a>Aim</h2>
<p>We want to creates <span class="math inline">\(NDatasets=200\)</span> datasets with <span class="math inline">\(\textrm{length}(group)=500\)</span> variables and <span class="math inline">\(N=25\)</span> observations. In that example we want <span class="math inline">\(1\)</span> group:</p>
<ul>
<li>
<span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{500}\)</span> belong to the same group and the intra-group Pearson correlation for this group is equal to <span class="math inline">\(.5\)</span>.</li>
<li>only the first five variables <span class="math inline">\(x_1\)</span>, , <span class="math inline">\(x_{5}\)</span> are explanatory variables for the response.</li>
</ul>
</div>
<div id="correlation-structure-2" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-structure-2" class="anchor"></a>Correlation structure</h2>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">500</span><span class="op">)</span> <span class="co">#500 variables</span>
  <span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="explanatory-variables-and-response-1" class="section level2">
<h2 class="hasAnchor">
<a href="#explanatory-variables-and-response-1" class="anchor"></a>Explanatory variables and response</h2>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span>
<span class="va">N</span><span class="op">&lt;-</span><span class="fl">25</span>
<span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">495</span><span class="op">)</span><span class="op">)</span>
<span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span>
<span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span>
<span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
  <span class="va">C</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span>
  <span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">C</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="checks-3" class="section level2">
<h2 class="hasAnchor">
<a href="#checks-3" class="anchor"></a>Checks</h2>
<p>We now check the correlation structure of the explanatory variable. First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corr_mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span>
<span class="co">#&gt;  [1,] 1.0000000 0.4684444 0.4944331 0.4628645 0.4961487 0.4956996 0.4654665</span>
<span class="co">#&gt;  [2,] 0.4684444 1.0000000 0.5102506 0.5026134 0.4960774 0.4948349 0.4813972</span>
<span class="co">#&gt;  [3,] 0.4944331 0.5102506 1.0000000 0.4853991 0.4907725 0.5089649 0.4925889</span>
<span class="co">#&gt;  [4,] 0.4628645 0.5026134 0.4853991 1.0000000 0.4670240 0.4837113 0.4948130</span>
<span class="co">#&gt;  [5,] 0.4961487 0.4960774 0.4907725 0.4670240 1.0000000 0.4932811 0.4723250</span>
<span class="co">#&gt;  [6,] 0.4956996 0.4948349 0.5089649 0.4837113 0.4932811 1.0000000 0.4759705</span>
<span class="co">#&gt;  [7,] 0.4654665 0.4813972 0.4925889 0.4948130 0.4723250 0.4759705 1.0000000</span>
<span class="co">#&gt;  [8,] 0.4890355 0.5001703 0.4838451 0.4782784 0.4867136 0.4750897 0.4680615</span>
<span class="co">#&gt;  [9,] 0.4815475 0.4979561 0.4917091 0.4906115 0.4726156 0.4944805 0.4906298</span>
<span class="co">#&gt; [10,] 0.4834349 0.4830943 0.4945958 0.4778387 0.4763692 0.5051952 0.4770014</span>
<span class="co">#&gt;            [,8]      [,9]     [,10]</span>
<span class="co">#&gt;  [1,] 0.4890355 0.4815475 0.4834349</span>
<span class="co">#&gt;  [2,] 0.5001703 0.4979561 0.4830943</span>
<span class="co">#&gt;  [3,] 0.4838451 0.4917091 0.4945958</span>
<span class="co">#&gt;  [4,] 0.4782784 0.4906115 0.4778387</span>
<span class="co">#&gt;  [5,] 0.4867136 0.4726156 0.4763692</span>
<span class="co">#&gt;  [6,] 0.4750897 0.4944805 0.5051952</span>
<span class="co">#&gt;  [7,] 0.4680615 0.4906298 0.4770014</span>
<span class="co">#&gt;  [8,] 1.0000000 0.4959996 0.4743232</span>
<span class="co">#&gt;  [9,] 0.4959996 1.0000000 0.4932802</span>
<span class="co">#&gt; [10,] 0.4743232 0.4932802 1.0000000</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span>
<span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://www-stat.stanford.edu/~hastie/Papers/#LARS">lars</a></span><span class="op">)</span>
<span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, 
              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span>
<span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,
              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, 
              plot.it<span class="op">=</span><span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span>
<span class="co"># Use the "+1SE rule" to find best model: </span>
<span class="co">#    Take the min CV and add its SE ("limit").  </span>
<span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span>
<span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span>
<span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Print out coefficients at optimal s.</span>
<span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span>
<span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
<span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span>
<span class="op">}</span>
<span class="op">}</span>
<span class="va">error_counter</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span>
<span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were sucessful, yet only 20 variables coefficients could be estimated with regular least squares estimates for the linear model. Then we display and plot that the mean coefficient vector values for the least squares estimates.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">coef_mean</span>, <span class="fl">40</span><span class="op">)</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 1.503770e+00 1.535116e+00 1.484148e+00 1.509255e+00 1.514028e+00 3.173485e-15 </span>
<span class="co">#&gt;           x7           x8           x9          x10          x11          x12 </span>
<span class="co">#&gt; 3.037102e-15 2.889551e-15 3.154865e-15 7.183429e-15 3.394267e-15 2.841336e-15 </span>
<span class="co">#&gt;          x13          x14          x15          x16          x17          x18 </span>
<span class="co">#&gt; 3.716311e-15 3.182421e-15 3.427576e-15 3.919400e-15 4.673144e-15 3.955783e-15 </span>
<span class="co">#&gt;          x19          x20          x21          x22          x23          x24 </span>
<span class="co">#&gt; 3.303872e-15 5.303571e-15 5.550495e-15 3.081008e-15 2.254520e-15 3.381582e-15 </span>
<span class="co">#&gt;          x25          x26          x27          x28          x29          x30 </span>
<span class="co">#&gt; 3.730642e-15           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x31          x32          x33          x34          x35          x36 </span>
<span class="co">#&gt;           NA           NA           NA           NA           NA           NA </span>
<span class="co">#&gt;          x37          x38          x39          x40 </span>
<span class="co">#&gt;           NA           NA           NA           NA</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-42-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>, <span class="fl">40</span><span class="op">)</span>
<span class="co">#&gt;           x1           x2           x3           x4           x5           x6 </span>
<span class="co">#&gt; 3.163481e-01 2.992011e-01 2.460792e-01 2.619038e-01 3.138343e-01 1.633413e-03 </span>
<span class="co">#&gt;           x7           x8           x9          x10          x11          x12 </span>
<span class="co">#&gt; 8.285933e-03 2.664676e-03 1.286248e-03 2.328200e-03 8.799246e-04 8.072028e-03 </span>
<span class="co">#&gt;          x13          x14          x15          x16          x17          x18 </span>
<span class="co">#&gt; 4.276199e-03 6.158855e-03 2.491027e-03 0.000000e+00 6.908800e-04 1.025494e-03 </span>
<span class="co">#&gt;          x19          x20          x21          x22          x23          x24 </span>
<span class="co">#&gt; 5.153866e-04 1.810606e-04 2.887157e-03 1.164730e-02 3.420346e-03 0.000000e+00 </span>
<span class="co">#&gt;          x25          x26          x27          x28          x29          x30 </span>
<span class="co">#&gt; 0.000000e+00 1.058844e-02 2.764924e-03 0.000000e+00 0.000000e+00 0.000000e+00 </span>
<span class="co">#&gt;          x31          x32          x33          x34          x35          x36 </span>
<span class="co">#&gt; 2.711486e-03 3.698186e-03 3.852792e-05 3.575717e-03 0.000000e+00 1.036557e-02 </span>
<span class="co">#&gt;          x37          x38          x39          x40 </span>
<span class="co">#&gt; 1.824428e-03 6.567690e-03 1.557148e-03 8.436719e-03</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-with-sb_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
<p>The simulation process looks sucessfull: the lasso estimates retrives mostly the correct variables, yet the other ones are also selected sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Frederic Bertrand, Myriam Maumy-Bertrand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
