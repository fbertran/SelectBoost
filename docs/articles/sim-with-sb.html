<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation Tools Provided With the Selectboost Package • SelectBoost</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Tools Provided With the Selectboost Package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SelectBoost</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/benchmarking-selectboost-networks.html">Benchmarking the SelectBoost Package for Network Reverse Engineering</a></li>
    <li><a class="dropdown-item" href="../articles/confidence-indices-Cascade-networks.html">Towards Confidence Estimates in Cascade Networks using the SelectBoost Package</a></li>
    <li><a class="dropdown-item" href="../articles/sim-with-sb.html">Simulation Tools Provided With the Selectboost Package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/fbertran/SelectBoost/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulation Tools Provided With the Selectboost Package</h1>
                        <h4 data-toc-skip class="author">Frédéric
Bertrand and Myriam Maumy-Bertrand</h4>
            <address class="author_afil">
      Université de Strasbourg and CNRSIRMA, labex
IRMIA<br><a class="author_email" href="mailto:#"></a><a href="mailto:frederic.bertrand@lecnam.net" class="email">frederic.bertrand@lecnam.net</a>
      </address>
                  
            <h4 data-toc-skip class="date">2025-09-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fbertran/SelectBoost/blob/HEAD/vignettes/sim-with-sb.Rmd" class="external-link"><code>vignettes/sim-with-sb.Rmd</code></a></small>
      <div class="d-none name"><code>sim-with-sb.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="contents">Contents<a class="anchor" aria-label="anchor" href="#contents"></a>
</h2>
<p>This vignette details the simulations tools provided with the
selectboost package by providing five examples of use.</p>
<p>If you are a Linux/Unix or a Macos user, you can install a version of
SelectBoost with support for <code>doMC</code> from <a href="https://github.com" class="external-link">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"fbertran/SelectBoost"</span>, ref <span class="op">=</span> <span class="st">"doMC"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="first-example">First example<a class="anchor" aria-label="anchor" href="#first-example"></a>
</h2>
<div class="section level3">
<h3 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h3>
<p>We want to creates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">length</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\textrm{length}(group)=10</annotation></semantics></math>
variables and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">N=10</annotation></semantics></math>
observations. In that example we want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>9</mn><annotation encoding="application/x-tex">9</annotation></semantics></math>
groups:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>10</mn></msub><annotation encoding="application/x-tex">x_{10}</annotation></semantics></math>
belong to the first group and the intra-group Pearson correlation for
this group is equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>.95</mn><annotation encoding="application/x-tex">.95</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math>
belongs to the second group,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>3</mn></msub><annotation encoding="application/x-tex">x_3</annotation></semantics></math>
belongs to the third group,</li>
<li>…</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>9</mn></msub><annotation encoding="application/x-tex">x_9</annotation></semantics></math>
belongs to the ninth group.</li>
</ul>
</div>
<div class="section level3">
<h3 id="correlation-structure">Correlation structure<a class="anchor" aria-label="anchor" href="#correlation-structure"></a>
</h3>
<p>The correlation structure of the explanatory variables of the dataset
is provided by <code>group</code> and the intra-group Pearson
correlation value for each of the groups by <code>cor_group</code>. A
value must be provided even for single variable groups and the number of
variables is length of the <code>group</code> vector. Use the
<code>simulation_cor</code> function to create the correlation matrix
(<code>CM</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/SelectBoost/">SelectBoost</a></span><span class="op">)</span></span>
<span><span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#10 variables</span></span>
<span><span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">CM</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span></span>
<span><span class="va">CM</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explanatory-dataset-generation">Explanatory dataset generation<a class="anchor" aria-label="anchor" href="#explanatory-dataset-generation"></a>
</h3>
<p>Then generation of an explanatory dataset with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">N=10</annotation></semantics></math>
observations is made by the <code>simulation_X</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">10</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span></span>
<span><span class="va">X</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="response-derivation">Response derivation<a class="anchor" aria-label="anchor" href="#response-derivation"></a>
</h3>
<p>A response can now be added to the dataset by the
<code>simulation_Data</code> function. We have to specifiy the support
of the response, i.e. the explanatory variables that will be used in the
linear model created to compute the response. The support is given by
the <code>supp</code> vector whose entries are either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>.
The length of the <code>supp</code> vector must be equal to the number
of explanatory variables and if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>entry
is equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>,
it means that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>variable
will be used to derive the response value, whereas if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>entry
is equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>,
it means that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>variable
will not be used to derive the response value
(<code>beta&lt;-rep(0,length(supp))</code>). The values of the
coefficients for the explanatory variables that are in the support of
the response are random (either absolute value and sign) and given by
<code>beta[which(supp==1)]&lt;-runif(sum(supp),minB,maxB)*(rbinom(sum(supp),1,.5)*2-1)</code>.
Hence, the user can specify their minimal absolute value with the
<code>minB</code> option and their maximal absolute value with the
<code>maxB</code> option. The <code>stn</code> option is a scaling
factor for the noise added to the response vector
(<code>(t(beta)%*%var(X)%*%beta)/stn</code>, with <code>X</code> the
matrix of explanatory variables). The higher the <code>stn</code> value,
the smaller the noise: for instance for a given <code>X</code> dataset,
an <code>stn</code> value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
times larger will result in a noise exactly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mi>α</mi></msqrt><annotation encoding="application/x-tex">\sqrt{\alpha}</annotation></semantics></math>
times smaller.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span></span>
<span><span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span></span>
<span><span class="va">firstdataset</span><span class="op">=</span><span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span></span>
<span><span class="va">firstdataset</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-datasets-and-checks">Multiple datasets and checks<a class="anchor" aria-label="anchor" href="#multiple-datasets-and-checks"></a>
</h3>
<p>To generate multiple datasets, repeat steps 2 and 3, for instance use
a <code>for</code> loop. We create
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets and assign them to the objects <code>DATA_exemple1_nb_1</code>
to <code>DATA_exemple1_nb_200</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">NDatasets</span><span class="op">=</span><span class="fl">200</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We now check the correlation structure of the explanatory variable.
First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter</span></span>
<span><span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean
coefficient vector values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>Reduce the noise in the response for the new responses by a factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mn>5000</mn><mi>/</mi><mn>50</mn></mrow></msqrt><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\sqrt{5000/50}=10</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>s</mi><mi>t</mi><mi>n</mi><mo>⋅</mo><msubsup><mi>β</mi><mrow><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></mrow><mi>t</mi></msubsup><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>β</mi><mrow><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">1/stn\cdot \beta_{support}^t\mathrm{Var}(X)\beta_{support}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{support}</annotation></semantics></math>
is the vector of coefficients wh</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">stn</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">CM</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Since it is the same explanatory dataset for response generation, we
can compare the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
between those
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stn_ratios</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NDatasets</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">stn_ratios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span><span class="op">/</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">stn_ratios</span>,<span class="va">all.equal</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>All the ratios are equal to 10 as anticipated.</p>
<p>Since, the correlation structure is the same as before, we do not
need to check it again. As befor, we infer the coefficients values of a
linear model using the <code>lm</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum_bis</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum_bis</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter_bis</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple1_bis_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter_bis</span><span class="op">=</span><span class="va">error_counte_bisr</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum_bis</span><span class="op">=</span><span class="va">coef_sum_bis</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter_bis</span></span>
<span><span class="va">coef_mean_bis</span><span class="op">=</span><span class="va">coef_sum_bis</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>All fits were sucessful. Then we display and plot that the mean
coefficient vector values. As expected, the noise reduction enhances the
retrieval of the <code>true</code> mean coefficient absolute values by
the models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_mean_bis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean_bis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>The simulation process looks sucessfull. What are the confidence
indices for those variables?</p>
</div>
</div>
<div class="section level2">
<h2 id="second-example">Second example<a class="anchor" aria-label="anchor" href="#second-example"></a>
</h2>
<div class="section level3">
<h3 id="aim-1">Aim<a class="anchor" aria-label="anchor" href="#aim-1"></a>
</h3>
<p>We want to creates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">length</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">\textrm{length}(group)=50</annotation></semantics></math>
variables and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">N=20</annotation></semantics></math>
observations. In that example we want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
group:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>,
,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>50</mn></msub><annotation encoding="application/x-tex">x_{50}</annotation></semantics></math>
belong to the same group and the intra-group Pearson correlation for
this group is equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>.5</mn><annotation encoding="application/x-tex">.5</annotation></semantics></math>.</li>
<li>only the first five variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>,
,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>5</mn></msub><annotation encoding="application/x-tex">x_{5}</annotation></semantics></math>
are explanatory variables for the response.</li>
</ul>
</div>
<div class="section level3">
<h3 id="correlation-structure-1">Correlation structure<a class="anchor" aria-label="anchor" href="#correlation-structure-1"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">50</span><span class="op">)</span> <span class="co">#50 variables</span></span>
<span><span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explanatory-variables-and-response">Explanatory variables and response<a class="anchor" aria-label="anchor" href="#explanatory-variables-and-response"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">20</span></span>
<span><span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span></span>
<span><span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">C</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">C</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checks">Checks<a class="anchor" aria-label="anchor" href="#checks"></a>
</h3>
<p>We now check the correlation structure of the explanatory variable.
First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067" class="external-link">lars</a></span><span class="op">)</span></span>
<span><span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html" class="external-link">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, </span>
<span>              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></span>
<span><span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html" class="external-link">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple2_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>              plot.it<span class="op">=</span><span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span></span>
<span><span class="co"># Use the "+1SE rule" to find best model: </span></span>
<span><span class="co">#    Take the min CV and add its SE ("limit").  </span></span>
<span><span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span></span>
<span><span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Print out coefficients at optimal s.</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter</span></span>
<span><span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></span>
<span><span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were
sucessful, yet only 20 variables coefficients could be estimated with
regular least squares estimates for the linear model. Then we display
and plot that the mean coefficient vector values for the least squares
estimates.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_lasso_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives
mostly the correct variables, yet the other ones are also selected
sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div class="section level2">
<h2 id="third-example">Third Example<a class="anchor" aria-label="anchor" href="#third-example"></a>
</h2>
<div class="section level3">
<h3 id="aim-2">Aim<a class="anchor" aria-label="anchor" href="#aim-2"></a>
</h3>
<p>We want to creates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">length</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">\textrm{length}(supp)=100</annotation></semantics></math>
variables and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>24</mn></mrow><annotation encoding="application/x-tex">N=24</annotation></semantics></math>
observations. In that example we use real data for the <code>X</code>
variables that we sample from all the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1650</mn><annotation encoding="application/x-tex">1650</annotation></semantics></math>
probesets that are differentially expressed between the two conditions
US and S. The main interest of that simulation is that the correlation
structure of the <code>X</code> dataset will be a real one.</p>
</div>
<div class="section level3">
<h3 id="data-and-response-generations">Data and response generations<a class="anchor" aria-label="anchor" href="#data-and-response-generations"></a>
</h3>
<p>First retrieve the datasets and get the differentially expressed
probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/CascadeData/" class="external-link">CascadeData</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">micro_S</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">micro_US</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/Cascade/" class="external-link">Cascade</a></span><span class="op">)</span></span>
<span><span class="va">micro_US</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/as.micro_array.html" class="external-link">as.micro_array</a></span><span class="op">(</span><span class="va">micro_US</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">micro_S</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/as.micro_array.html" class="external-link">as.micro_array</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/geneSelection.html" class="external-link">geneSelection</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="va">micro_US</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"condition"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Sel</span><span class="op">&lt;-</span><span class="va">micro_S</span><span class="op">@</span><span class="va">microarray</span><span class="op">[</span><span class="va">S</span><span class="op">@</span><span class="va">name</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<p>Generates the datasets sampling for each of them 100 probesets
expressions among the 1650 that were selected and linking the response
to the expressions of the first five probesets.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span></span>
<span><span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span></span>
<span><span class="va">NDatasets</span><span class="op">=</span><span class="fl">200</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Xnorm</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">Xnorm</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checks-1">Checks<a class="anchor" aria-label="anchor" href="#checks-1"></a>
</h3>
<p>Here are the plots of an example of correlation structure, namely for
<code>DATA_exemple3_nb_200$X</code>. Run the code to get the
graphics.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/cim.html" class="external-link">cim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067" class="external-link">lars</a></span><span class="op">)</span></span>
<span><span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html" class="external-link">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, </span>
<span>              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></span>
<span><span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html" class="external-link">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple3_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>              plot.it<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span></span>
<span><span class="co"># Use the "+1SE rule" to find best model: </span></span>
<span><span class="co">#    Take the min CV and add its SE ("limit").  </span></span>
<span><span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span></span>
<span><span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Print out coefficients at optimal s.</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter</span></span>
<span><span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></span>
<span><span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were
sucessful, yet only 20 variables coefficients could be estimated with
regular least squares estimates for the linear model. Then we display
and plot that the mean coefficient vector values for the least squares
estimates.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_lasso_mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives
mostly the correct variables, yet the other ones are also selected
sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
<div class="section level2">
<h2 id="fourth-example">Fourth Example<a class="anchor" aria-label="anchor" href="#fourth-example"></a>
</h2>
<div class="section level3">
<h3 id="aim-3">Aim<a class="anchor" aria-label="anchor" href="#aim-3"></a>
</h3>
<p>We want to creates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>101</mn></mrow><annotation encoding="application/x-tex">NDatasets=101</annotation></semantics></math>
datasets with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">length</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">\textrm{length}(supp)=100</annotation></semantics></math>
variables and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>18</mn></mrow><annotation encoding="application/x-tex">N=18</annotation></semantics></math>
observations. In that example we use real data for the variables that
are the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>101</mn><annotation encoding="application/x-tex">101</annotation></semantics></math>
probesets that are the more differentially expressed between the two
conditions US and S. We create
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>101</mn><annotation encoding="application/x-tex">101</annotation></semantics></math>
datasets by leaving one of the variables out each time and using it as
the response that shall be predicted. We also only use for the
explanatory variables the observations that are the measurements for the
1st, 2nd and 3rd timepoints and for the responses the observations that
are the measurements of the same variables for the 2nd, 3rd and 4th
timepoints. The main interest of that simulation is that the correlation
structure of the <code>X</code> dataset will be a real one and that it
is a typical setting for cascade network reverse-engineering in genomics
or proteomics, see the <code>Cascade</code> package for more
details.</p>
</div>
<div class="section level3">
<h3 id="data-and-response-generations-1">Data and response generations<a class="anchor" aria-label="anchor" href="#data-and-response-generations-1"></a>
</h3>
<p>First retrieve the datasets and get the differentially expressed
probesets. Run the code to get additionnal plots.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/CascadeData/" class="external-link">CascadeData</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">micro_S</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">micro_US</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://fbertran.github.io/Cascade/" class="external-link">Cascade</a></span><span class="op">)</span></span>
<span><span class="va">micro_US</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/as.micro_array.html" class="external-link">as.micro_array</a></span><span class="op">(</span><span class="va">micro_US</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">micro_S</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/as.micro_array.html" class="external-link">as.micro_array</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>,<span class="fl">90</span>,<span class="fl">240</span>,<span class="fl">390</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">S</span><span class="op">&lt;-</span><span class="fu"><a href="https://fbertran.github.io/Cascade/reference/geneSelection.html" class="external-link">geneSelection</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">micro_S</span>,<span class="va">micro_US</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"condition"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">101</span><span class="op">)</span></span>
<span><span class="va">Sel</span><span class="op">&lt;-</span><span class="va">micro_S</span><span class="op">@</span><span class="va">microarray</span><span class="op">[</span><span class="va">S</span><span class="op">@</span><span class="va">name</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">suppt</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">95</span><span class="op">)</span><span class="op">)</span> <span class="co">#not used since we use one of the probeset expressions as response</span></span>
<span><span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span> <span class="co">#not used since we use one of the probeset expressions as response</span></span>
<span><span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span> <span class="co">#not used since we use one of the probeset expressions as response</span></span>
<span><span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span> <span class="co">#not used since we use one of the probeset expressions as response</span></span>
<span><span class="va">NDatasets</span><span class="op">&lt;-</span><span class="fl">101</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#the explanatory variables are the values for the 1st, 2nd and 3rd timepoints</span></span>
<span>  <span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="op">-</span><span class="va">i</span>,<span class="va">suppt</span><span class="op">!=</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Xnorm</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">DATA</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">Xnorm</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span></span>
<span>  <span class="co">#the reponses are the values for the 2nd, 3rd and 4th timepoints</span></span>
<span>  <span class="va">DATA</span><span class="op">$</span><span class="va">Y</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Sel</span><span class="op">[</span><span class="va">i</span>,<span class="va">suppt</span><span class="op">!=</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="va">DATA</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checks-2">Checks<a class="anchor" aria-label="anchor" href="#checks-2"></a>
</h3>
<p>Here are the plots of an example of correlation structure, namely for
<code>DATA_exemple3_nb_200$X</code>. Run the code to get the
graphics.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">mixOmics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mixOmics/man/cim.html" class="external-link">cim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Xnorm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">supp</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067" class="external-link">lars</a></span><span class="op">)</span></span>
<span><span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html" class="external-link">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, </span>
<span>              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></span>
<span><span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html" class="external-link">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple4_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>              plot.it<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span></span>
<span><span class="co"># Use the "+1SE rule" to find best model: </span></span>
<span><span class="co">#    Take the min CV and add its SE ("limit").  </span></span>
<span><span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span></span>
<span><span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Print out coefficients at optimal s.</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">[</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter</span></span>
<span><span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></span>
<span><span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were
sucessful, yet only 20 variables coefficients could be estimated with
regular least squares estimates for the linear model. Then we display
and plot that the mean coefficient vector values for the least squares
estimates.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coef_mean</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span><span class="op">)</span></span></code></pre></div>
<p>Some probesets seem explanatory for many other ones (=hubs). What are
the confidence indices for those variables?</p>
</div>
</div>
<div class="section level2">
<h2 id="fifth-example">Fifth Example<a class="anchor" aria-label="anchor" href="#fifth-example"></a>
</h2>
<div class="section level3">
<h3 id="aim-4">Aim<a class="anchor" aria-label="anchor" href="#aim-4"></a>
</h3>
<p>We want to creates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">NDatasets=200</annotation></semantics></math>
datasets with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">length</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">\textrm{length}(group)=500</annotation></semantics></math>
variables and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">N=25</annotation></semantics></math>
observations. In that example we want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
group:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>,
,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>500</mn></msub><annotation encoding="application/x-tex">x_{500}</annotation></semantics></math>
belong to the same group and the intra-group Pearson correlation for
this group is equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>.5</mn><annotation encoding="application/x-tex">.5</annotation></semantics></math>.</li>
<li>only the first five variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>,
,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>5</mn></msub><annotation encoding="application/x-tex">x_{5}</annotation></semantics></math>
are explanatory variables for the response.</li>
</ul>
</div>
<div class="section level3">
<h3 id="correlation-structure-2">Correlation structure<a class="anchor" aria-label="anchor" href="#correlation-structure-2"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">500</span><span class="op">)</span> <span class="co">#500 variables</span></span>
<span>  <span class="va">cor_group</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explanatory-variables-and-response-1">Explanatory variables and response<a class="anchor" aria-label="anchor" href="#explanatory-variables-and-response-1"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3141</span><span class="op">)</span></span>
<span><span class="va">N</span><span class="op">&lt;-</span><span class="fl">25</span></span>
<span><span class="va">supp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">495</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minB</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span><span class="va">maxB</span><span class="op">&lt;-</span><span class="fl">2</span></span>
<span><span class="va">stn</span><span class="op">&lt;-</span><span class="fl">50</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">C</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_cor</a></span><span class="op">(</span><span class="va">group</span>,<span class="va">cor_group</span><span class="op">)</span></span>
<span>  <span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/simulation.html">simulation_X</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">C</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,<span class="fu"><a href="../reference/simulation.html">simulation_DATA</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">supp</span>,<span class="va">minB</span>,<span class="va">maxB</span>,<span class="va">stn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checks-3">Checks<a class="anchor" aria-label="anchor" href="#checks-3"></a>
</h3>
<p>We now check the correlation structure of the explanatory variable.
First we compute the mean correlation matrix.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">corr_sum</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">corr_mean</span><span class="op">=</span><span class="va">corr_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>Then we display and plot that the mean correlation matrix.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr_mean</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">corr_mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coef_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coef_lasso_sum</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">NDatasets</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">tempdf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tempcoef</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">.</span><span class="op">-</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">tempdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://doi.org/10.1214/009053604000000067" class="external-link">lars</a></span><span class="op">)</span></span>
<span><span class="va">lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/lars.html" class="external-link">lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, type<span class="op">=</span><span class="st">"lasso"</span>, </span>
<span>              trace<span class="op">=</span><span class="cn">FALSE</span>, normalize<span class="op">=</span><span class="cn">FALSE</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># cv.lars() uses crossvalidation to estimate optimal position in path</span></span>
<span><span class="va">cv.lasso.1</span> <span class="op">&lt;-</span> <span class="fu">lars</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lars/man/cv.lars.html" class="external-link">cv.lars</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DATA_exemple5_nb_"</span>,<span class="va">i</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>              plot.it<span class="op">=</span><span class="cn">FALSE</span>, type<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span></span>
<span><span class="co"># Use the "+1SE rule" to find best model: </span></span>
<span><span class="co">#    Take the min CV and add its SE ("limit").  </span></span>
<span><span class="co">#    Find smallest model that has its own CV within this limit (at "s.cv.1")</span></span>
<span><span class="va">limit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span> <span class="op">+</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv.error</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">s.cv.1</span> <span class="op">&lt;-</span> <span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cv.lasso.1</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;</span> <span class="va">limit</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Print out coefficients at optimal s.</span></span>
<span><span class="va">coef_lasso_sum</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lasso.1</span>, s<span class="op">=</span><span class="va">s.cv.1</span>, mode<span class="op">=</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Error in lm fit, skip coefficients\n"</span><span class="op">)</span></span>
<span><span class="va">error_counter</span><span class="op">=</span><span class="va">error_counter</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span><span class="va">coef_sum</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempcoef</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">error_counter</span></span>
<span><span class="va">coef_mean</span><span class="op">=</span><span class="va">coef_sum</span><span class="op">/</span><span class="va">NDatasets</span></span>
<span><span class="va">coef_lasso_mean</span><span class="op">=</span><span class="va">coef_lasso_sum</span><span class="op">/</span><span class="va">NDatasets</span></span></code></pre></div>
<p>With regular least squares and lasso estimators all fits were
sucessful, yet only 20 variables coefficients could be estimated with
regular least squares estimates for the linear model. Then we display
and plot that the mean coefficient vector values for the least squares
estimates.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coef_mean</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">coef_lasso_mean</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="op">(</span><span class="va">minB</span><span class="op">+</span><span class="va">maxB</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>The simulation process looks sucessfull: the lasso estimates retrives
mostly the correct variables, yet the other ones are also selected
sometimes. What are the confidence indices for those variables?</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Frederic Bertrand, Myriam Maumy-Bertrand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
